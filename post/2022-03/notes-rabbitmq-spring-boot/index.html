<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Notes on RabbitMQ with Spring Boot - Spring Cloud</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="description" content="This article introduces amqp protocol, dead letter queue, exchange, queue, etc. in rabbitmq. And it shows how to apply them in spring boot." />
<meta name="keywords" content="spring-boot, rabbitmq" />







<meta name="generator" content="Hugo 0.92.2" />


<link rel="canonical" href="https://www.springcloud.io/post/2022-03/notes-rabbitmq-spring-boot/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Notes on RabbitMQ with Spring Boot" />
<meta property="og:description" content="This article introduces amqp protocol, dead letter queue, exchange, queue, etc. in rabbitmq. And it shows how to apply them in spring boot." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.springcloud.io/post/2022-03/notes-rabbitmq-spring-boot/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-23T10:22:06+08:00" />
<meta property="article:modified_time" content="2022-03-23T10:22:06+08:00" />

<meta itemprop="name" content="Notes on RabbitMQ with Spring Boot">
<meta itemprop="description" content="This article introduces amqp protocol, dead letter queue, exchange, queue, etc. in rabbitmq. And it shows how to apply them in spring boot."><meta itemprop="datePublished" content="2022-03-23T10:22:06+08:00" />
<meta itemprop="dateModified" content="2022-03-23T10:22:06+08:00" />
<meta itemprop="wordCount" content="1496">
<meta itemprop="keywords" content="spring-boot,rabbitmq," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notes on RabbitMQ with Spring Boot"/>
<meta name="twitter:description" content="This article introduces amqp protocol, dead letter queue, exchange, queue, etc. in rabbitmq. And it shows how to apply them in spring boot."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->





<script async src="https://www.googletagmanager.com/gtag/js?id=G-N9WSHEG9H6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N9WSHEG9H6');
</script>



 
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761"
     crossorigin="anonymous"></script>

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Spring Cloud</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/forum">Forum</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = 'b3ac69fdeaebb32a4';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Spring Cloud
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/forum">Forum</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Notes on RabbitMQ with Spring Boot</h1>
      
      <div class="post-meta">
        <time datetime="2022-03-23" class="post-time">
          2022-03-23
        </time>
        <div class="post-category">
            <a href="https://www.springcloud.io/categories/tutorials/"> tutorials </a>
            
          </div>
        <span class="more-meta"> 1496 words </span>
          <span class="more-meta"> 8 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#up-and-running">Up and running</a></li>
    <li><a href="#amqp">AMQP</a>
      <ul>
        <li><a href="#exchange-queue-and-binding">Exchange, queue, and binding</a></li>
        <li><a href="#routing">Routing</a></li>
      </ul>
    </li>
    <li><a href="#declarative-configuration-with-spring-amqp">Declarative configuration with Spring AMQP</a></li>
    <li><a href="#listener-container">Listener container</a></li>
    <li><a href="#messages-are-ephemeral">Messages are ephemeral</a></li>
    <li><a href="#resilience">Resilience</a>
      <ul>
        <li><a href="#acknowledgment">Acknowledgment</a></li>
        <li><a href="#dead-letter-exchange">Dead letter exchange</a></li>
        <li><a href="#retry">Retry</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="introduction">Introduction</h2>
<p>Suppose our application organizes asynchronous domain logic inside <code>DomainEventListener</code>&rsquo;s like the following code snippet.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">interface</span> <span class="nc">DomainEventListener</span> <span class="p">{</span>
  <span class="k">val</span> <span class="py">topic</span><span class="p">:</span> <span class="n">String</span>
  <span class="k">fun</span> <span class="nf">handle</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">DomainEvent</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@Component</span>
<span class="k">class</span> <span class="nc">UserRegistered</span><span class="p">:</span> <span class="n">DomainEventListener</span> <span class="p">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="py">topic</span> <span class="p">=</span> <span class="s2">&#34;user:registered&#34;</span>
  
  <span class="c1">// How deserialization is performed is left out.
</span><span class="c1"></span>  
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">handle</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">DomainEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// perform business logic
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This post shows how to integrate these listeners with Spring AMQP by taking advantage of Spring&rsquo;s infrastructure. We
also briefly discuss several important topics on using messaging middleware.</p>
<h2 id="up-and-running">Up and running</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">rabbitmq</span> <span class="o">-</span><span class="n">p</span> <span class="n">5672</span><span class="o">:</span><span class="n">5672</span> <span class="o">-</span><span class="n">p</span> <span class="n">15672</span><span class="o">:</span><span class="n">15672</span> <span class="n">rabbitmq</span><span class="o">:</span><span class="n">3</span><span class="o">-</span><span class="n">management</span>
</code></pre></td></tr></table>
</div>
</div><p>The web management UI is available at <a href="http://localhost:15672">http://localhost:15672</a>. The default username and
password are both <code>guest</code>.</p>
<p><a href="https://spring.io/guides/gs/messaging-rabbitmq/"><em>Messaging with RabbitMQ</em></a> is a very basic Hello World example for
Spring Boot integration.</p>
<p>For a more production-ready setting, it&rsquo;s mandatory to refer to
the <a href="https://docs.spring.io/spring-amqp/docs/current/reference/html">Spring AMQP reference documentation</a>.</p>
<h2 id="amqp">AMQP</h2>
<p>AMQP (Advanced Message Queuing Protocol) is an application layer protocol for messaging middleware. RabbitMQ primarily
supports the AMQP 0-9-1 model. It mainly revolves around the following three <em>AMQP entities</em>:</p>
<ul>
<li>exchange</li>
<li>queue</li>
<li>binding</li>
</ul>
<h3 id="exchange-queue-and-binding">Exchange, queue, and binding</h3>
<p>Messages are published to an <em>exchange</em> and consumed from a <em>queue</em>.
A queue can subscribe to exchanges with <em>bindings</em>.
When a message arrives at an exchange, it will be routed to different queues based on:</p>
<ul>
<li>the <em>routing key</em> in the message, and</li>
<li>the type of the addressed exchange.</li>
</ul>
<h3 id="routing">Routing</h3>
<p>The four basic types of exchange are:</p>
<ul>
<li>Direct exchange</li>
<li>Fanout exchange</li>
<li>Topic exchange</li>
<li>Headers exchange</li>
</ul>
<p>The routing mechanism further decouples the publisher and subscriber, making it easy to adapt to different workflows. It
may look overwhelming at first sight, so we are sticking with the simplest Direct Exchange. In this
case, the message will be routed to subscribing queues with the same routing key.</p>
<p>To learn more about RabbitMQ and AMQP, I would
recommend <a href="https://www.manning.com/books/rabbitmq-in-depth">RabbitMQ in Depth</a>. Its clear explanation and
illustration make it easier to grasp these concepts.</p>
<h2 id="declarative-configuration-with-spring-amqp">Declarative configuration with Spring AMQP</h2>
<p>With Spring AMQP, we can configure the required AMQP entities in the message broker by registering them as beans in the
application context. At runtime, Spring AMQP will issue requests to the broker and create them.</p>
<p>I like this declarative approach. It feels like Kubernetes without nasty YAML configurations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="nd">@Configuration</span>
<span class="k">class</span> <span class="nc">RabbitMqConfig</span> <span class="p">{</span>
  <span class="nd">@Bean</span>
  <span class="k">fun</span> <span class="nf">domainEventExchange</span><span class="p">()</span> <span class="p">=</span> 
    <span class="n">DirectExchange</span><span class="p">(</span><span class="s2">&#34;domain_events&#34;</span><span class="p">)</span>

  <span class="nd">@Bean</span>
  <span class="k">fun</span> <span class="nf">queues</span><span class="p">(</span><span class="n">listeners</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DomainEventListener</span><span class="p">&gt;)</span> <span class="p">=</span> 
    <span class="n">Declarables</span><span class="p">(</span> <span class="c1">// highlight-line
</span><span class="c1"></span>      <span class="n">listeners</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span>
        <span class="n">QueueBuilder</span>
          <span class="p">.</span><span class="n">durable</span><span class="p">(</span><span class="k">it</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">simpleName</span><span class="p">)</span> <span class="c1">// highlight-line
</span><span class="c1"></span>          <span class="p">.</span><span class="n">build</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">)</span>

  <span class="nd">@Bean</span>
  <span class="k">fun</span> <span class="nf">bindings</span><span class="p">(</span><span class="n">listeners</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DomainEventListener</span><span class="p">&gt;)</span> <span class="p">=</span> 
    <span class="n">Declarables</span><span class="p">(</span>
      <span class="n">queues</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">listeners</span><span class="p">)</span> <span class="p">{</span> <span class="n">queue</span><span class="p">,</span> <span class="n">listener</span> <span class="o">-&gt;</span>
        <span class="n">BindingBuilder</span>
          <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
          <span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">domainEventExchange</span><span class="p">())</span>
          <span class="p">.</span><span class="n">with</span><span class="p">(</span><span class="n">listener</span><span class="p">.</span><span class="n">topic</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In this code snippet, we first declare an application-wide <code>domainEventExchange</code>. Then, we loop over
the <code>DomainEventListener</code>&rsquo;s in the application context and create the necessary queues and bindings.</p>
<p>Note that:</p>
<ol>
<li>We can declare multiple AMQP entities in a <code>Declarables</code>. They don&rsquo;t need to be the same type.</li>
<li><code>durable</code> means the created entity will survive broker restart.</li>
</ol>
<h2 id="listener-container">Listener container</h2>
<p>So far, we have declared desired entities in the broker, but haven&rsquo;t yet wired up our <code>DomainEventListener</code>&rsquo;s to consume
messages from it and perform business logic. To do so, we need to wrap our event handlers
inside a <code>MessageListenerContainer</code>.</p>
<p>A <code>MessageListenerContainer</code> represents an <em>active</em> or <em>hot</em> component. It handles the connection to the message broker.
When the connection is broken, <code>SimpleMessageListenerConainer</code> will try to restart the listener. As a lifecycle
component, it provides methods for starting and stopping.</p>
<p>To programmatically register our domain listeners, we can implement <code>RabbitListenerConfigurer</code> and use
the <code>RabbitListenerEndpointRegistrar</code> like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="nd">@Configuration</span>
<span class="nd">@EnableRabbit</span>
<span class="k">class</span> <span class="nc">ContainerConfig</span><span class="p">(</span>
  <span class="k">val</span> <span class="py">listeners</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DomainEventListener</span><span class="p">&gt;,</span>
  <span class="k">val</span> <span class="py">containerFactory</span><span class="p">:</span> <span class="n">SimpleRabbitListenerContainerFactory</span>
<span class="p">):</span> <span class="n">RabbitListenerConfigurer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">configureRabbitListeners</span><span class="p">(</span>
    <span class="n">registrar</span><span class="p">:</span> <span class="n">RabbitListenerEndpointRegistrar</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">setContainerFactory</span><span class="p">(</span><span class="n">containerFactory</span><span class="p">)</span> <span class="c1">// highlight-line
</span><span class="c1"></span>    <span class="n">listeners</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">listener</span> <span class="o">-&gt;</span>
      <span class="k">val</span> <span class="py">endpoint</span> <span class="p">=</span> <span class="n">SimpleRabbitListenerEndpoint</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">listener</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">simpleName</span><span class="o">!!</span>
        <span class="n">setQueueNames</span><span class="p">(</span><span class="n">listener</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">simpleName</span><span class="p">)</span>
        <span class="n">setMessageListener</span> <span class="p">{</span> <span class="n">message</span> <span class="o">-&gt;</span>
          <span class="n">listener</span><span class="p">.</span><span class="n">handle</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">toDomainEvent</span><span class="p">())</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">registrar</span><span class="p">.</span><span class="n">registerEndpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span> <span class="c1">// highlight-line
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Spring AMQP will take care of creating the listener containers at runtime. Note that we passed an instance
of <code>RabbitListenerContainerFactory</code> to the registrar. We will see that we can configure common properties of the
containers through the container factory.</p>
<p>Check out more details at:</p>
<ul>
<li><a href="https://docs.spring.io/spring-amqp/docs/current/reference/html/#container">Spring AMQP Reference: Containers</a></li>
<li><a href="https://docs.spring.io/spring-amqp/docs/current/reference/html/#async-annotation-driven-registration">Spring AMQP Reference: Programmatic Endpoint Registration</a></li>
</ul>
<h2 id="messages-are-ephemeral">Messages are ephemeral</h2>
<p>It&rsquo;s important to realize that in the AMQP model, the message broker just acts as a postman between sender and receiver.
It holds on to the messages only temporarily.
After successful delivery to all consumers, the message is usually removed from the broker.</p>
<p>In contrast, Redis Stream and Kafka are more like databases that store the messages until explicitly deleted.</p>
<p>Some repercussions:</p>
<ul>
<li><em>It&rsquo;s easy to lose messages if something is misconfigured.</em> For example, a message published to an exchange with no
bound queues will be dropped. Conceptually, it seems only queues in AMQP have <em>memory</em>.</li>
<li><em>No first-class support for doing CRUD on messages.</em> For example, the web UI does not have a list screen to page
through the messages. It&rsquo;s possible to retrieve a few ones in the queue detail page, but it has a warning that says
&ldquo;Getting messages from a queue is a destructive action.&rdquo; Although not necessarily always &ldquo;destructive&rdquo;, the action will
probably cause side effects on the message.</li>
<li><em>Spring AMQP shares this kind of mindset.</em> For example, it is important to configure a <code>MessageRecoverer</code> in
a <code>RetryInterceptor</code>. By default, Spring AMQP will drop the message after retrying for configured times and issue a
warning. Retry is discussed in the following section.</li>
</ul>
<h2 id="resilience">Resilience</h2>
<p><a href="https://docs.spring.io/spring-amqp/docs/current/reference/html/#resilience-recovering-from-errors-and-broker-failures">Spring AMQP Reference: Resilience: Recovering from Errors and Broker Failures</a></p>
<h3 id="acknowledgment">Acknowledgment</h3>
<p>Message consumers can fail at any time (due to business exceptions, dropped connections, application crash, etc). To
prevent losing messages in this way, message brokers use acknowledgments: a message is removed from the broker only
after the client explicitly acknowledges that it has processed it.</p>
<blockquote>
<p>In Laravel, when a job is taken from the queue, it&rsquo;s placed at <code>myqueue:reserved</code> key at the same time. These two steps form an atomic operation by using Lua scripting. This can also be seen as a form of acknowledgment.</p>
</blockquote>
<h3 id="dead-letter-exchange">Dead letter exchange</h3>
<p><a href="https://www.rabbitmq.com/dlx.html">RabbitMQ Dead Letter Documentation</a></p>
<p>Suppose there is a mal-formed message.
In our Spring application, if our message handlers throw an exception due to this message, by default,
the message will be re-queued and delivered again, resulting in an infinite loop.
A viable solution would be sending the bad message to other places for inspection after a few retries.</p>
<p>RabbitMQ can handle this situation with <a href="https://www.rabbitmq.com/dlx.html">dead letter exchanges</a>. When our consumer
negatively acknowledges a message, the queue will &ldquo;dead-letter&rdquo; the message (annotate with some information about the
failure) and route it to the configured dead letter exchange. This configuration can be applied globally in the broker
with a policy or specified when creating a queue.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">rabbitmqctl set_policy DLX <span class="s2">&#34;.*&#34;</span> <span class="s1">&#39;{&#34;dead-letter-exchange&#34;:&#34;my-dlx&#34;}&#39;</span> --apply-to queues
</code></pre></td></tr></table>
</div>
</div><p>You can also apply a policy in the RabbitMQ web UI under the &ldquo;admin&rdquo; tag.</p>
<p>Note that the dead letter exchange is just a regular exchange. If you specify a non-existent exchange, RabbitMQ does not
create it automatically. This is a type of misconfiguration that can cause lost messages.</p>
<p>AMQP entity declaration in Spring for configuring dead letter exchanges:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="nd">@Bean</span>
<span class="k">fun</span> <span class="nf">deadLetterExchange</span><span class="p">()</span> <span class="p">=</span> <span class="n">DirectExchange</span><span class="p">(</span><span class="s2">&#34;dlx&#34;</span><span class="p">)</span>

<span class="nd">@Bean</span>
<span class="k">fun</span> <span class="nf">deadLetterQueues</span><span class="p">(</span>
  <span class="n">listeners</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DomainEventListener</span><span class="p">&gt;</span>
<span class="p">)</span> <span class="p">=</span> <span class="n">Declarables</span><span class="p">(</span>
  <span class="k">val</span> <span class="py">name</span> <span class="p">=</span> <span class="k">it</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">simpleName</span>
  <span class="n">listeners</span><span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="c1">// highlight-line
</span><span class="c1"></span>    <span class="k">val</span> <span class="py">deadLetterQueue</span> <span class="p">=</span> <span class="n">QueueBuilder</span><span class="p">.</span><span class="n">durable</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$name</span><span class="s2">.dlq&#34;</span><span class="p">).</span><span class="n">build</span><span class="p">()</span>
    <span class="k">val</span> <span class="py">deadLetterBinding</span> <span class="p">=</span> <span class="n">BindingBuilder</span>
      <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">deadLetterQueue</span><span class="p">)</span>
      <span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">deadLetterExchange</span><span class="p">())</span>
      <span class="p">.</span><span class="n">with</span><span class="p">(</span><span class="k">it</span><span class="p">.</span><span class="n">topic</span><span class="p">)</span>

    <span class="n">listOf</span><span class="p">(</span><span class="n">deadLetterQueue</span><span class="p">,</span> <span class="n">deadLetterBinding</span><span class="p">)</span> <span class="c1">// highlight-line
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>For each listener, we create:</p>
<ul>
<li>a corresponding dead letter queue, and</li>
<li>its binding to the application-wide <code>deadLetterExchange()</code>.</li>
</ul>
<p>By properly configuring listening queues and bindings, we ensure dead letters won&rsquo;t get lost.</p>
<p>Then, update our <code>queues()</code> code to configure the queues' dead letter exchange.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="nd">@Bean</span>
<span class="k">fun</span> <span class="nf">deadLetterExchange</span><span class="p">()</span> <span class="p">=</span> <span class="n">DirectExchange</span><span class="p">(</span><span class="s2">&#34;dlx&#34;</span><span class="p">)</span>

<span class="nd">@Bean</span>
<span class="k">fun</span> <span class="nf">queues</span><span class="p">(</span><span class="n">listeners</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DomainEventListener</span><span class="p">&gt;)</span> <span class="p">=</span> <span class="n">Declarables</span><span class="p">(</span>
  <span class="n">listeners</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span>
    <span class="n">QueueBuilder</span><span class="p">.</span><span class="n">durable</span><span class="p">(</span><span class="k">it</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">simpleName</span><span class="p">)</span>
      <span class="p">.</span><span class="n">withDeadLetterExchange</span><span class="p">(</span><span class="n">deadLetterExchange</span><span class="p">())</span> <span class="c1">// highlight-line
</span><span class="c1"></span>      <span class="p">.</span><span class="n">build</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nf">QueueBuilder</span><span class="p">.</span><span class="n">withDeadLetterExchange</span><span class="p">(</span><span class="n">exchange</span><span class="p">:</span> <span class="n">Exchange</span><span class="p">):</span> <span class="n">QueueBuilder</span> <span class="p">=</span>
  <span class="n">withArgument</span><span class="p">(</span><span class="s2">&#34;x-dead-letter-exchange&#34;</span><span class="p">,</span> <span class="n">exchange</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="c1">// highlight-line
</span></code></pre></td></tr></table>
</div>
</div><p>We also need to set up our listener containers to instruct RabbitMQ not to requeue rejected messages. If a dead letter
exchange is configured on the queue, the message will be routed to it. Otherwise, the message will be dropped.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="n">SimpleRabbitListenerContainerFactory</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
  <span class="n">setDefaultRequeueRejected</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="n">setConnectionFactory</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Laravel&rsquo;s <a href="https://laravel.com/docs/8.x/queues#dealing-with-failed-jobs">failed jobs</a> table is the equivalent concept.</p>
</blockquote>
<h3 id="retry">Retry</h3>
<p>It may be helpful to retry a few times before routing a failed message to the dead letter exchange. Spring provides some
retry helpers, and we can configure them in the container factory like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="nd">@Bean</span>
<span class="k">fun</span> <span class="nf">retryInterceptor</span><span class="p">()</span> <span class="p">=</span> <span class="n">RetryInterceptorBuilder</span><span class="p">()</span>
  <span class="p">.</span><span class="n">stateless</span><span class="p">()</span>
  <span class="p">.</span><span class="n">maxAttemtps</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
  <span class="p">.</span><span class="n">backOffOptions</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="m">2.0</span><span class="p">,</span> <span class="m">10</span><span class="n">_000</span><span class="p">)</span>
  <span class="p">.</span><span class="n">recoverer</span><span class="p">(</span><span class="n">RejectAndDontRequeueRecoverer</span><span class="p">())</span> <span class="c1">// highlight-line
</span><span class="c1"></span>  <span class="p">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">SimpleRabbitListenerContainerFactory</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
  <span class="n">setDefaultRequeueRejected</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="n">setConnectionFactory</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">)</span>
  <span class="n">setAdviceChain</span><span class="p">(</span><span class="n">retryInterceptor</span><span class="p">())</span> <span class="c1">// highlight-line
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Reference <code>https://blog.yujinyan.me/posts/notes-rabbitmq-spring-boot/</code></p>
</blockquote>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://www.springcloud.io/tags/spring-boot/">spring-boot</a>
          <a href="https://www.springcloud.io/tags/rabbitmq/">rabbitmq</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2022-03/graalvm-spring-native/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Building Native Images with GraalVM and Spring Native on Apple&#39;s M1 Architecture</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/2022-03/netflix-zuul-to-spring-cloud-gateway/">
            <span class="next-text nav-default">Moving from Spring Cloud Netflix Zuul to Spring Cloud Gateway</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://twitter.com/springcloud_io" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>


<a href="https://www.springcloud.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2021 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
