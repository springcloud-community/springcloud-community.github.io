<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spring cache source code analysis - Spring Cloud</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="description" content="This article analyzes the source code of spring cache and introduces the parsing and execution process of spring cache." />
<meta name="keywords" content="Spring Cache, Analysis, Source Code" />







<meta name="generator" content="Hugo 0.96.0" />


<link rel="canonical" href="https://www.springcloud.io/post/2022-03/spring-cache-source-code-analysis/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Spring cache source code analysis" />
<meta property="og:description" content="This article analyzes the source code of spring cache and introduces the parsing and execution process of spring cache." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.springcloud.io/post/2022-03/spring-cache-source-code-analysis/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-31T18:02:46+08:00" />
<meta property="article:modified_time" content="2022-03-31T18:02:46+08:00" />

<meta itemprop="name" content="Spring cache source code analysis">
<meta itemprop="description" content="This article analyzes the source code of spring cache and introduces the parsing and execution process of spring cache."><meta itemprop="datePublished" content="2022-03-31T18:02:46+08:00" />
<meta itemprop="dateModified" content="2022-03-31T18:02:46+08:00" />
<meta itemprop="wordCount" content="2658">
<meta itemprop="keywords" content="spring-cache," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring cache source code analysis"/>
<meta name="twitter:description" content="This article analyzes the source code of spring cache and introduces the parsing and execution process of spring cache."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->





<script async src="https://www.googletagmanager.com/gtag/js?id=G-N9WSHEG9H6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N9WSHEG9H6');
</script>



 
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761"
     crossorigin="anonymous"></script>


</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Spring Cloud</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://forum.springcloud.io" rel="noopener" target="_blank">
              Forum
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = 'b3ac69fdeaebb32a4';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Spring Cloud
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://forum.springcloud.io" rel="noopener" target="_blank">
              Forum
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Spring cache source code analysis</h1>
      
      <div class="post-meta">
        <time datetime="2022-03-31" class="post-time">
          2022-03-31
        </time>
        <div class="post-category">
            <a href="https://www.springcloud.io/categories/tutorials/"> tutorials </a>
            
          </div>
        <span class="more-meta"> 2658 words </span>
          <span class="more-meta"> 6 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#off-topic-how-to-read-open-source-code">Off-topic: How to read open source code?</a></li>
    <li><a href="#core-class-diagram">Core Class Diagram</a></li>
    <li><a href="#source-code-analysis-with-comments-explained">Source code analysis (with comments explained)</a>
      <ul>
        <li><a href="#1-parsing-annotations">1. Parsing annotations</a></li>
        <li><a href="#2-logic-execution">2. Logic execution</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>Spring cache is a caching API layer that encapsulates common operations for a variety of caches and can easily add caching functionality to your application with the help of annotations.</p>
<p>The common annotations are <code>@Cacheable</code>, <code>@CachePut</code>, <code>@CacheEvict</code>, ever wondered what is the principle behind them? With questions, after reading the source code of Spring cache, make a brief summary.</p>
<p><strong>First the conclusion, the core logic in the CacheAspectSupport class</strong> , which encapsulates the main logic of all cache operations, is described in detail below.</p>
<h2 id="off-topic-how-to-read-open-source-code">Off-topic: How to read open source code?</h2>
<p>There are 2 methods, which can be used in combination.</p>
<ul>
<li><strong>static code reading</strong> : find the key classes, methods where the usages, skilled use of find usages function, find all relevant classes, methods, static analysis of the core logic of the implementation process, step by step, until the establishment of the full picture.</li>
<li><strong>Run-time debug</strong>: add breakpoints on key methods and write a unit test to call the class library/framework, skillfully use step into/step over/resume to dynamically analyze the code execution process.</li>
</ul>
<h2 id="core-class-diagram">Core Class Diagram</h2>
<p><img src="https://cdn.jsdelivr.net/gh/springcloud-community/image-bucket/2022/03/31/fd41a9c49a434595b6feda2f3ad19deb.png" alt="spring cache class"></p>
<p>As shown in the figure, it can be divided into the following classes.</p>
<ul>
<li><code>Cache</code>, <code>CacheManager</code>: Cache abstracts common operations of cache, such as get, put, and CacheManager is a collection of Cache. The reason why multiple Cache objects are needed is because of the need for multiple cache expiration times, cache entry limits, etc.</li>
<li><code>CacheInterceptor</code>, <code>CacheAspectSupport</code>, <code>AbstractCacheInvoker</code>: <code>CacheInterceptor</code> is an AOP method interceptor that does additional logic before and after the method, i.e. querying the cache, writing to the cache, etc. It inherits from .<code>CacheAspectSupport</code> (the main logic of cache operations), <code>AbstractCacheInvoker</code> (encapsulates reading and writing to the Cache)</li>
<li><code>CacheOperation</code>, <code>AnnotationCacheOperationSource</code>, <code>SpringCacheAnnotationParser</code>: <code>CacheOperation</code> defines the cache name, cache key, cache condition condition, cache operation <code>CacheManager</code>, etc. <code>AnnotationCacheOperationSource</code> is a class that gets the cache annotation corresponding to the CacheOperation, while <code>SpringCacheAnnotationParser</code> is the class that actually parses the annotation, and after parsing it is encapsulated into the CacheOperation collection for <code>AnnotationCacheOperationSource</code> to find.</li>
</ul>
<h2 id="source-code-analysis-with-comments-explained">Source code analysis (with comments explained)</h2>
<p>The following is an analysis of Spring cache source code with annotated explanations and only excerpts of core code snippets.</p>
<h3 id="1-parsing-annotations">1. Parsing annotations</h3>
<p>First look at how annotations are parsed. Annotation is just a marker, to make it really work, you need to do parsing operations on annotations and also have the corresponding actual logic.</p>
<h4 id="springcacheannotationparser-responsible-for-parsing-annotations-return-cacheoperation-collection">SpringCacheAnnotationParser: responsible for parsing annotations, return CacheOperation collection</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringCacheAnnotationParser</span> <span class="kd">implements</span> <span class="n">CacheAnnotationParser</span><span class="o">,</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Parsing class-level cache annotations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">parseCacheAnnotations</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">DefaultCacheConfig</span> <span class="n">defaultConfig</span> <span class="o">=</span> <span class="n">getDefaultCacheConfig</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">parseCacheAnnotations</span><span class="o">(</span><span class="n">defaultConfig</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 解析方法级别的缓存注解
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">parseCacheAnnotations</span><span class="o">(</span><span class="n">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">DefaultCacheConfig</span> <span class="n">defaultConfig</span> <span class="o">=</span> <span class="n">getDefaultCacheConfig</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">parseCacheAnnotations</span><span class="o">(</span><span class="n">defaultConfig</span><span class="o">,</span> <span class="n">method</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Parsing cache annotations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">parseCacheAnnotations</span><span class="o">(</span><span class="n">DefaultCacheConfig</span> <span class="n">cachingConfig</span><span class="o">,</span> <span class="n">AnnotatedElement</span> <span class="n">ae</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">ops</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Parsing the @Cacheable annotation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Cacheable</span><span class="o">&gt;</span> <span class="n">cacheables</span> <span class="o">=</span> <span class="n">AnnotatedElementUtils</span><span class="o">.</span><span class="na">getAllMergedAnnotations</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">Cacheable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(!</span><span class="n">cacheables</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ops</span> <span class="o">=</span> <span class="n">lazyInit</span><span class="o">(</span><span class="n">ops</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="o">(</span><span class="n">Cacheable</span> <span class="n">cacheable</span> <span class="o">:</span> <span class="n">cacheables</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">ops</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">parseCacheableAnnotation</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">cachingConfig</span><span class="o">,</span> <span class="n">cacheable</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Parsing the @CacheEvict annotation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheEvict</span><span class="o">&gt;</span> <span class="n">evicts</span> <span class="o">=</span> <span class="n">AnnotatedElementUtils</span><span class="o">.</span><span class="na">getAllMergedAnnotations</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">CacheEvict</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(!</span><span class="n">evicts</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ops</span> <span class="o">=</span> <span class="n">lazyInit</span><span class="o">(</span><span class="n">ops</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="o">(</span><span class="n">CacheEvict</span> <span class="n">evict</span> <span class="o">:</span> <span class="n">evicts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">ops</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">parseEvictAnnotation</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">cachingConfig</span><span class="o">,</span> <span class="n">evict</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Parsing the @CachePut annotation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CachePut</span><span class="o">&gt;</span> <span class="n">puts</span> <span class="o">=</span> <span class="n">AnnotatedElementUtils</span><span class="o">.</span><span class="na">getAllMergedAnnotations</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">CachePut</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(!</span><span class="n">puts</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ops</span> <span class="o">=</span> <span class="n">lazyInit</span><span class="o">(</span><span class="n">ops</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="o">(</span><span class="n">CachePut</span> <span class="n">put</span> <span class="o">:</span> <span class="n">puts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">ops</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">parsePutAnnotation</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">cachingConfig</span><span class="o">,</span> <span class="n">put</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Parsing the @Caching annotation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Caching</span><span class="o">&gt;</span> <span class="n">cachings</span> <span class="o">=</span> <span class="n">AnnotatedElementUtils</span><span class="o">.</span><span class="na">getAllMergedAnnotations</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">Caching</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(!</span><span class="n">cachings</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ops</span> <span class="o">=</span> <span class="n">lazyInit</span><span class="o">(</span><span class="n">ops</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="o">(</span><span class="n">Caching</span> <span class="n">caching</span> <span class="o">:</span> <span class="n">cachings</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">cachingOps</span> <span class="o">=</span> <span class="n">parseCachingAnnotation</span><span class="o">(</span><span class="n">ae</span><span class="o">,</span> <span class="n">cachingConfig</span><span class="o">,</span> <span class="n">caching</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="o">(</span><span class="n">cachingOps</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">ops</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">cachingOps</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">ops</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="annotationcacheoperationsource">AnnotationCacheOperationSource</h4>
<p>call SpringCacheAnnotationParser to get the annotation corresponding to the CacheOperation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnnotationCacheOperationSource</span> <span class="kd">extends</span> <span class="n">AbstractFallbackCacheOperationSource</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Find a list of CacheOperation at the class level
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">protected</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">findCacheOperations</span><span class="o">(</span><span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">determineCacheOperations</span><span class="o">(</span><span class="k">new</span> <span class="n">CacheOperationProvider</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">			<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">getCacheOperations</span><span class="o">(</span><span class="n">CacheAnnotationParser</span> <span class="n">parser</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="na">parseCacheAnnotations</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Find the list of CacheOperation at the method level
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">protected</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">findCacheOperations</span><span class="o">(</span><span class="kd">final</span> <span class="n">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">determineCacheOperations</span><span class="o">(</span><span class="k">new</span> <span class="n">CacheOperationProvider</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">			<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">getCacheOperations</span><span class="o">(</span><span class="n">CacheAnnotationParser</span> <span class="n">parser</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="na">parseCacheAnnotations</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">});</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="abstractfallbackcacheoperationsource">AbstractFallbackCacheOperationSource</h4>
<p>The parent class of AnnotationCacheOperationSource, which implements the common logic of getting CacheOperation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractFallbackCacheOperationSource</span> <span class="kd">implements</span> <span class="n">CacheOperationSource</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * Cache of CacheOperations, keyed by method on a specific target class.
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * &lt;p&gt;As this base class is not marked Serializable, the cache will be recreated
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * after serialization - provided that the concrete subclass is Serializable.
</span></span></span><span class="line"><span class="cl"><span class="cm">	 */</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;&gt;</span> <span class="n">attributeCache</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">			<span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;&gt;(</span><span class="n">1024</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// According to Method, Class reflection information, get the corresponding CacheOperation list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">getCacheOperations</span><span class="o">(</span><span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">targetClass</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Object</span> <span class="n">cacheKey</span> <span class="o">=</span> <span class="n">getCacheKey</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">cached</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attributeCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Because parsing reflection information is time-consuming, so use map cache to avoid double counting
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// If already recorded in map, return directly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="n">cached</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="o">(</span><span class="n">cached</span> <span class="o">!=</span> <span class="n">NULL_CACHING_ATTRIBUTE</span> <span class="o">?</span> <span class="n">cached</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Otherwise do a calculation and write to map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">cacheOps</span> <span class="o">=</span> <span class="n">computeCacheOperations</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(</span><span class="n">cacheOps</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Adding cacheable method &#39;&#34;</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;&#39; with attribute: &#34;</span> <span class="o">+</span> <span class="n">cacheOps</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">this</span><span class="o">.</span><span class="na">attributeCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">,</span> <span class="n">cacheOps</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">this</span><span class="o">.</span><span class="na">attributeCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">,</span> <span class="n">NULL_CACHING_ATTRIBUTE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">cacheOps</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Calculate the list of cache operations, giving priority to the annotations on the methods of the target proxy class, followed by the target proxy class if it does not exist, then the methods of the original class, and finally the original class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="nf">computeCacheOperations</span><span class="o">(</span><span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">targetClass</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Don&#39;t allow no-public methods as required.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="n">allowPublicMethodsOnly</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Modifier</span><span class="o">.</span><span class="na">isPublic</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// The method may be on an interface, but we need attributes from the target class.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// If the target class is null, the method will be unchanged.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Method</span> <span class="n">specificMethod</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">getMostSpecificMethod</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// If we are dealing with method with generic parameters, find the original method.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">specificMethod</span> <span class="o">=</span> <span class="n">BridgeMethodResolver</span><span class="o">.</span><span class="na">findBridgedMethod</span><span class="o">(</span><span class="n">specificMethod</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// call findCacheOperations (implemented by the subclass AnnotationCacheOperationSource), which is eventually parsed by the SpringCacheAnnotationParser
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// First try is the method in the target class.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">opDef</span> <span class="o">=</span> <span class="n">findCacheOperations</span><span class="o">(</span><span class="n">specificMethod</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">opDef</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">opDef</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Second try is the caching operation on the target class.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">opDef</span> <span class="o">=</span> <span class="n">findCacheOperations</span><span class="o">(</span><span class="n">specificMethod</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">opDef</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isUserLevelMethod</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">opDef</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">specificMethod</span> <span class="o">!=</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Fallback is to look at the original method.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">opDef</span> <span class="o">=</span> <span class="n">findCacheOperations</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(</span><span class="n">opDef</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">opDef</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Last fallback is the class of the original method.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">opDef</span> <span class="o">=</span> <span class="n">findCacheOperations</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(</span><span class="n">opDef</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isUserLevelMethod</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">opDef</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-logic-execution">2. Logic execution</h3>
<p>Take the logic behind <code>@Cacheable</code> as an example. The expectation is to check the cache first and use the cache value directly if the cache hits, otherwise execute the business logic and write the result to the cache.</p>
<h4 id="proxycachingconfiguration">ProxyCachingConfiguration</h4>
<p>is a configuration class that generates a Spring bean for the <code>CacheInterceptor</code> class and the <code>CacheOperationSource</code> class.</p>
<h4 id="cacheinterceptor">CacheInterceptor</h4>
<p>is an AOP method interceptor that gets the CacheOperation result of step 1 parsing annotations (e.g. cache name, cache key, condition condition) through <code>CacheOperationSource</code>, essentially intercepting the execution of the original method and adding logic before and after.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Core class, cache interceptor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CacheInterceptor</span> <span class="kd">extends</span> <span class="n">CacheAspectSupport</span> <span class="kd">implements</span> <span class="n">MethodInterceptor</span><span class="o">,</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Intercept the execution of the original method and add logic before and after
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="kd">final</span> <span class="n">MethodInvocation</span> <span class="n">invocation</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">invocation</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Encapsulate the execution of the original method into a callback interface for subsequent calls
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">CacheOperationInvoker</span> <span class="n">aopAllianceInvoker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CacheOperationInvoker</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">			<span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                                        <span class="c1">// Execution of the original method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="k">return</span> <span class="n">invocation</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">throw</span> <span class="k">new</span> <span class="n">ThrowableWrapper</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Call the methods of the parent class CacheAspectSupport
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span> <span class="n">execute</span><span class="o">(</span><span class="n">aopAllianceInvoker</span><span class="o">,</span> <span class="n">invocation</span><span class="o">.</span><span class="na">getThis</span><span class="o">(),</span> <span class="n">method</span><span class="o">,</span> <span class="n">invocation</span><span class="o">.</span><span class="na">getArguments</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">catch</span> <span class="o">(</span><span class="n">CacheOperationInvoker</span><span class="o">.</span><span class="na">ThrowableWrapper</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="n">th</span><span class="o">.</span><span class="na">getOriginal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="cacheaspectsupport">CacheAspectSupport</h4>
<p>CacheAspectSupport class, the parent class of CacheInterceptor, encapsulates the main logic of all cache operations.</p>
<p>The main process is as follows.</p>
<ol>
<li>through the <code>CacheOperationSource</code>, get all the <code>CacheOperation</code> list.</li>
<li>if there is <code>@CacheEvict</code> annotation, and marked as executed before the call, then do the delete/empty cache operation.</li>
<li>if <code>@Cacheable</code> annotation is present, query the cache.</li>
<li>if the cache is not hit (the query result is null), add to cachePutRequests and write to the cache after subsequent execution of the original method.</li>
<li>If the cache hits, the cache value is used as the result; if the cache does not hit, or if there is a <code>@CachePut</code> annotation, the original method needs to be called and the return value of the original method is used as the result.</li>
<li>if there is <code>@CachePut</code> annotation, then add to cachePutRequests.</li>
<li>if the cache is not hit, the query result value is written to the cache; if there is <code>@CachePut</code> annotation, the method execution result is also written to the cache.</li>
<li>if there is <code>@CacheEvict</code> annotation and it is marked as executed after the call, then do the delete/empty cache operation.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// The core class, the cache cut support class, encapsulates the main logic of all cache operations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">CacheAspectSupport</span> <span class="kd">extends</span> <span class="n">AbstractCacheInvoker</span>
</span></span><span class="line"><span class="cl">		<span class="kd">implements</span> <span class="n">BeanFactoryAware</span><span class="o">,</span> <span class="n">InitializingBean</span><span class="o">,</span> <span class="n">SmartInitializingSingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// CacheInterceptor calls this method of the parent class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">protected</span> <span class="n">Object</span> <span class="nf">execute</span><span class="o">(</span><span class="n">CacheOperationInvoker</span> <span class="n">invoker</span><span class="o">,</span> <span class="n">Object</span> <span class="n">target</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Check whether aspect is enabled (to cope with cases where the AJ is pulled in automatically)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">initialized</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">targetClass</span> <span class="o">=</span> <span class="n">getTargetClass</span><span class="o">(</span><span class="n">target</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Get a list of all CacheOperations via CacheOperationSource
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperation</span><span class="o">&gt;</span> <span class="n">operations</span> <span class="o">=</span> <span class="n">getCacheOperationSource</span><span class="o">().</span><span class="na">getCacheOperations</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(!</span><span class="n">CollectionUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">operations</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                                <span class="c1">// Continue to call a private execute method to execute
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">return</span> <span class="n">execute</span><span class="o">(</span><span class="n">invoker</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="k">new</span> <span class="n">CacheOperationContexts</span><span class="o">(</span><span class="n">operations</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">args</span><span class="o">,</span> <span class="n">target</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If the spring bean is not initialized, the original method is called directly. This is equivalent to the original method not having caching capabilities.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">invoker</span><span class="o">.</span><span class="na">invoke</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">private的execute方法</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Object</span> <span class="nf">execute</span><span class="o">(</span><span class="kd">final</span> <span class="n">CacheOperationInvoker</span> <span class="n">invoker</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">CacheOperationContexts</span> <span class="n">contexts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Special handling of synchronized invocation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">isSynchronized</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">CacheOperationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CacheableOperation</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(</span><span class="n">isConditionPassing</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">CacheOperationExpressionEvaluator</span><span class="o">.</span><span class="na">NO_RESULT</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Object</span> <span class="n">key</span> <span class="o">=</span> <span class="n">generateKey</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">CacheOperationExpressionEvaluator</span><span class="o">.</span><span class="na">NO_RESULT</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">Cache</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getCaches</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span> <span class="n">wrapCacheValue</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">						<span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">							<span class="k">return</span> <span class="n">unwrapReturnValue</span><span class="o">(</span><span class="n">invokeOperation</span><span class="o">(</span><span class="n">invoker</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">						<span class="o">}</span>
</span></span><span class="line"><span class="cl">					<span class="o">}));</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">catch</span> <span class="o">(</span><span class="n">Cache</span><span class="o">.</span><span class="na">ValueRetrievalException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// The invoker wraps any Throwable in a ThrowableWrapper instance so we
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="c1">// can just make sure that one bubbles up the stack.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="k">throw</span> <span class="o">(</span><span class="n">CacheOperationInvoker</span><span class="o">.</span><span class="na">ThrowableWrapper</span><span class="o">)</span> <span class="n">ex</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// No caching required, only call the underlying method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">return</span> <span class="n">invokeOperation</span><span class="o">(</span><span class="n">invoker</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If there is a @CacheEvict annotation and it is marked as executed before the call, then do the delete/empty cache operation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Process any early evictions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">processCacheEvicts</span><span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CacheEvictOperation</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="kc">true</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">CacheOperationExpressionEvaluator</span><span class="o">.</span><span class="na">NO_RESULT</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If the @Cacheable annotation is present, the query cache
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Check if we have a cached item matching the conditions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">cacheHit</span> <span class="o">=</span> <span class="n">findCachedItem</span><span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CacheableOperation</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If the cache is not hit (the query result is null), it will be added to cachePutRequests, and the subsequent execution of the original method will be written to the cache
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Collect puts from any @Cacheable miss, if no cached item is found
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">List</span><span class="o">&lt;</span><span class="n">CachePutRequest</span><span class="o">&gt;</span> <span class="n">cachePutRequests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">CachePutRequest</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">cacheHit</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">collectPutRequests</span><span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CacheableOperation</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">					<span class="n">CacheOperationExpressionEvaluator</span><span class="o">.</span><span class="na">NO_RESULT</span><span class="o">,</span> <span class="n">cachePutRequests</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Object</span> <span class="n">cacheValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">Object</span> <span class="n">returnValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">cacheHit</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">cachePutRequests</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">hasCachePut</span><span class="o">(</span><span class="n">contexts</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// For cache hits, use the cache value as the result
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// If there are no put requests, just use the cache hit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cacheValue</span> <span class="o">=</span> <span class="n">cacheHit</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">returnValue</span> <span class="o">=</span> <span class="n">wrapCacheValue</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">cacheValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// If the cache is not hit, or if there is a @CachePut annotation, the original method needs to be called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// Invoke the method if we don&#39;t have a cache hit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="c1">// Call the original method and get the result value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">returnValue</span> <span class="o">=</span> <span class="n">invokeOperation</span><span class="o">(</span><span class="n">invoker</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">cacheValue</span> <span class="o">=</span> <span class="n">unwrapReturnValue</span><span class="o">(</span><span class="n">returnValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If there is a @CachePut annotation, then add to cachePutRequests
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Collect any explicit @CachePuts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">collectPutRequests</span><span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CachePutOperation</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">cacheValue</span><span class="o">,</span> <span class="n">cachePutRequests</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If the cache is not hit, the query result value is written to the cache; if the @CachePut annotation is present, the method execution result is also written to the cache
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Process any collected put requests, either from @CachePut or a @Cacheable miss
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="o">(</span><span class="n">CachePutRequest</span> <span class="n">cachePutRequest</span> <span class="o">:</span> <span class="n">cachePutRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">cachePutRequest</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">cacheValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// If there is a @CacheEvict annotation and it is marked as executed after the call, then do the delete/empty cache operation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Process any late evictions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">processCacheEvicts</span><span class="o">(</span><span class="n">contexts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CacheEvictOperation</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="n">cacheValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="nf">findCachedItem</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">CacheOperationContext</span><span class="o">&gt;</span> <span class="n">contexts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">CacheOperationExpressionEvaluator</span><span class="o">.</span><span class="na">NO_RESULT</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="o">(</span><span class="n">CacheOperationContext</span> <span class="n">context</span> <span class="o">:</span> <span class="n">contexts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Query the cache only if the condition is met
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="o">(</span><span class="n">isConditionPassing</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">result</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                                <span class="c1">// Generate the cache key, if the key is specified in the annotation, it is parsed according to the Spring expression, otherwise it is generated using the KeyGenerator class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">Object</span> <span class="n">key</span> <span class="o">=</span> <span class="n">generateKey</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                                <span class="c1">// Query the cache value according to the cache key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">cached</span> <span class="o">=</span> <span class="n">findInCaches</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="o">(</span><span class="n">cached</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span> <span class="n">cached</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;No cache entry for key &#39;&#34;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#34;&#39; in cache(s) &#34;</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="na">getCacheNames</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">					<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="nf">findInCaches</span><span class="o">(</span><span class="n">CacheOperationContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="o">(</span><span class="n">Cache</span> <span class="n">cache</span> <span class="o">:</span> <span class="n">context</span><span class="o">.</span><span class="na">getCaches</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Call the doGet method of the parent class AbstractCacheInvoker to query the cache
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="n">doGet</span><span class="o">(</span><span class="n">cache</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(</span><span class="n">wrapper</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;Cache entry for key &#39;&#34;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#34;&#39; found in cache &#39;&#34;</span> <span class="o">+</span> <span class="n">cache</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">wrapper</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="abstractcacheinvoker">AbstractCacheInvoker</h4>
<p>Parent class of CacheAspectSupport, encapsulating the logic of the final query Cache interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractCacheInvoker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// The final query cache method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">protected</span> <span class="n">Cache</span><span class="o">.</span><span class="na">ValueWrapper</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">Cache</span> <span class="n">cache</span><span class="o">,</span> <span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Calling the query method of the Spring Cache interface
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">catch</span> <span class="o">(</span><span class="n">RuntimeException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">getErrorHandler</span><span class="o">().</span><span class="na">handleCacheGetError</span><span class="o">(</span><span class="n">ex</span><span class="o">,</span> <span class="n">cache</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">// If the exception is handled, return a cache miss
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://www.springcloud.io/tags/spring-cache/">spring-cache</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2022-03/spring-framework-rce-early-announcement/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Spring Framework RCE, Early Announcement</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/2022-03/spring-resttemplate/">
            <span class="next-text nav-default">Complete Guide to Spring RestTemplate</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://twitter.com/springcloud_io" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>


<a href="https://www.springcloud.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2021 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
