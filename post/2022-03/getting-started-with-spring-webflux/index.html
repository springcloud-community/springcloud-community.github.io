<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Getting Started With Spring Webflux - Spring Cloud</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="description" content="Learn how Reactive Programming works. Learn about frameworks like Reactive Streams, Project Reactor, and get started with your first Spring Webflux application." />
<meta name="keywords" content="Spring Webflux, Project Reactor,  Reactive Streams" />







<meta name="generator" content="Hugo 0.92.2" />


<link rel="canonical" href="https://www.springcloud.io/post/2022-03/getting-started-with-spring-webflux/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Getting Started With Spring Webflux" />
<meta property="og:description" content="Learn how Reactive Programming works. Learn about frameworks like Reactive Streams, Project Reactor, and get started with your first Spring Webflux application." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.springcloud.io/post/2022-03/getting-started-with-spring-webflux/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-29T15:30:40+08:00" />
<meta property="article:modified_time" content="2022-03-29T15:30:40+08:00" />

<meta itemprop="name" content="Getting Started With Spring Webflux">
<meta itemprop="description" content="Learn how Reactive Programming works. Learn about frameworks like Reactive Streams, Project Reactor, and get started with your first Spring Webflux application."><meta itemprop="datePublished" content="2022-03-29T15:30:40+08:00" />
<meta itemprop="dateModified" content="2022-03-29T15:30:40+08:00" />
<meta itemprop="wordCount" content="3469">
<meta itemprop="keywords" content="spring-webfux,reactive-streams,project-reactor," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting Started With Spring Webflux"/>
<meta name="twitter:description" content="Learn how Reactive Programming works. Learn about frameworks like Reactive Streams, Project Reactor, and get started with your first Spring Webflux application."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->





<script async src="https://www.googletagmanager.com/gtag/js?id=G-N9WSHEG9H6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N9WSHEG9H6');
</script>



 
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761"
     crossorigin="anonymous"></script>

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Spring Cloud</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/forum">Forum</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          
        
      </li>
    

    
      <li class="mobile-menu-item">
        <a id="openSearchMobile" class="mobile-menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  
    
<div class="modal-dialog">
    
    <div class="modal-content">
      <div id="closeSearch" title="Close" class="close">X</div>
      <div class="modal-header">
        <div class="modal-title">Search</div>
      </div>
      <div class="modal-body">
          <script>
            (function() {
              var cx = 'b3ac69fdeaebb32a4';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = (document.location.protocol == 'https:' ? 'https:' :
                  'http:') +
                '//cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
      </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Spring Cloud
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/forum">Forum</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.springcloud.io/about/">About</a>
          

        

      </li>
    

    
    

    
      <li class="menu-item">
        <a id="openSearch" class="menu-item-link menu-item-search" href="#">
          <i class="iconfont">
            <svg version="1.1" viewBox="0 0 1024 1024"
  xmlns="http://www.w3.org/2000/svg" width="18" height="18"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M973.81454219 973.81454219a91.78207815 91.78207815 0 0 1-129.80999631 0l-161.97482118-161.97482118a425.48527711 425.48527711 0 0 1-230.35931791 68.16531768 428.3346319 428.3346319 0 1 1 428.3346319-428.3346319 425.48527711 425.48527711 0 0 1-68.16531768 230.35931791l162.02961656 161.97482118a91.83687354 91.83687354 0 0 1-0.05479538 129.80999631zM451.67040679 145.69361559a305.97679241 305.97679241 0 1 0 0 611.95358361 305.97679241 305.97679241 0 0 0 0-611.95358361z">
  </path>
</svg>

          </i>
        </a>
      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Getting Started With Spring Webflux</h1>
      
      <div class="post-meta">
        <time datetime="2022-03-29" class="post-time">
          2022-03-29
        </time>
        <div class="post-category">
            <a href="https://www.springcloud.io/categories/tutorials/"> tutorials </a>
            
          </div>
        <span class="more-meta"> 3469 words </span>
          <span class="more-meta"> 17 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#example-code">Example Code</a></li>
    <li><a href="#what-is-a-stream">What is a Stream?</a></li>
    <li><a href="#introducing-reactive-programming-paradigm">Introducing Reactive Programming Paradigm</a>
      <ul>
        <li><a href="#blocking-request">Blocking Request</a></li>
        <li><a href="#non-blocking-request">Non-Blocking Request</a></li>
        <li><a href="#backpressure">Backpressure</a></li>
        <li><a href="#reactive-java-libraries">Reactive Java Libraries</a></li>
      </ul>
    </li>
    <li><a href="#intro-to-java-9-reactive-streams-api">Intro to Java 9 Reactive Streams API</a></li>
    <li><a href="#introduction-to-spring-webflux">Introduction to Spring Webflux</a>
      <ul>
        <li><a href="#sping-webflux-dependencies">Sping Webflux Dependencies</a></li>
        <li><a href="#data-model">Data Model</a></li>
        <li><a href="#persistence-layer---defining-repositories">Persistence Layer - Defining Repositories</a></li>
        <li><a href="#service-layer">Service Layer</a></li>
        <li><a href="#web-layer">Web Layer</a></li>
        <li><a href="#server-sent-events">Server-Sent Events</a></li>
        <li><a href="#webflux-internals">Webflux Internals</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>Most traditional applications deal with <em>blocking</em> calls or, in other words, <em>synchronous</em> calls. This means that if we want to access a particular resource in a system with most of the threads being busy, then the application would block the new one or wait until the previous threads complete processing its requests.</p>
<p>If we want to process <em>Big Data</em> , however, we need to do this with immense speed and agility. That&rsquo;s when the software developers realized that they would need some kind of multi-threaded environment that handles asynchronous and non-blocking calls to make the best use of processing resources.</p>
<h2 id="example-code">Example Code</h2>
<p>This article is accompanied by a working code example <a href="https://github.com/thombergs/code-examples/tree/master/spring-webflux">on GitHub</a>.</p>
<h2 id="what-is-a-stream">What is a Stream?</h2>
<p>Before jumping on to the reactive part, we must understand what streams are. A <em>Stream</em> is a sequence of data that is transferred from one system to another. It traditionally operates in a blocking, sequential, and FIFO (first-in-first-out) pattern.</p>
<p>This blocking methodology of data streaming often prohibits a system to process real-time data while streaming. Thus, a bunch of prominent developers realized that they would need an approach to build a &ldquo;reactive&rdquo; systems architecture that would ease the processing of data <em>while streaming</em> . Hence, they signed a manifesto, popularly known as the <a href="https://www.reactivemanifesto.org/">Reactive Manifesto</a>.</p>
<p>The authors of the manifesto stated that a reactive system must be an <em>asynchronous</em> software that deals with <em>producers</em> who have the single responsibility to send messages to <em>consumers</em> . They introduced the following features to keep in mind:</p>
<ul>
<li><strong>Responsive</strong> : Reactive systems must be fast and responsive so that they can provide consistent high quality of service.</li>
<li><strong>Resilient</strong> : Reactive systems should be designed to anticipate system failures. Thus, they should be responsive through replication and isolation.</li>
<li><strong>Elastic</strong> : Reactive systems must be adaptive to shard or replicate components based upon their requirement. They should use predictive scaling to anticipate sudden ups and downs in their infrastructure.</li>
<li><strong>Message-driven</strong> : Since all the components in a reactive system are supposed to be loosely coupled, they must communicate across their boundaries by asynchronously exchanging messages.</li>
</ul>
<h2 id="introducing-reactive-programming-paradigm">Introducing Reactive Programming Paradigm</h2>
<p>Reactive programming is a programming paradigm that helps to implement non-blocking, asynchronous, and event-driven or message-driven data processing. It models data and events as streams that it can observe and react to by processing or transforming the data. Let&rsquo;s talk about the differences between blocking and non-blocking request processing.</p>
<h3 id="blocking-request">Blocking Request</h3>
<p>In a conventional MVC application, whenever a request reaches the server, a servlet thread is being created and delegated to worker threads to perform various operations like I/O, database processing, etc. While the worker threads are busy completing their processes, the servlet threads enter a waiting state due to which the calls remain blocked. This is blocking or synchronous request processing.</p>
<p><img src="https://cdn.jsdelivr.net/gh/springcloud-community/image-bucket/2022/03/29/befe6faead33471093e322439a1394e3.png" alt="blocking or synchronous request processing"></p>
<h3 id="non-blocking-request">Non-Blocking Request</h3>
<p>In a non-blocking system, all the incoming requests are accompanied by an event handler and a callback. The request thread delegates the incoming request to a thread pool that manages a pretty small number of threads. Then the thread pool delegates the request to its handler function and gets available to process the next incoming requests from the request thread.</p>
<p>When the handler function completes its process, one of the threads from the pool fetches the response and passes it to the callback function. Thus the threads in a non-blocking system never go into the waiting state. This increases the productivity and the performance of the application.</p>
<p>A single request is potentially processed by multiple threads!</p>
<p><img src="https://cdn.jsdelivr.net/gh/springcloud-community/image-bucket/2022/03/29/63364b452210436e82040268f27a69cf.png" alt="A single request is potentially processed by multiple threads"></p>
<h3 id="backpressure">Backpressure</h3>
<p>Working with reactive code, we often come across the term &ldquo;backpressure&rdquo;. It is an analogy derived from fluid dynamics which literally means the <em>resistance</em> or <em>force</em> that opposes the desired flow of data. In Reactive Streams, backpressure defines the mechanism to regulate the data transmission across streams.</p>
<p>Consider that server A sends 1000 EPS (events per second) to server B. But server B could only process 800 EPS and thus has a deficit of 200 EPS. Server B would now tend to fall behind as it has to process the deficit data and send it downstream or maybe store it in a database. Thus, server B deals with backpressure and soon will go out of memory and fail.</p>
<p>So, this backpressure can be handled or managed by the following options or strategies:</p>
<ul>
<li><em>Buffer</em> - We can easily buffer the deficit data and process it later when the server has capacity. But with a huge load of data coming in, this buffer might increase and the server would soon run out of memory.</li>
<li><em>Drop</em> - Dropping, i.e. not processing events, should be the last option. Usually, we can use the concept of data sampling combined with buffering to achieve less data loss.</li>
<li><em>Control</em> - The concept of controlling the producer that sends the data is by far the best option. Reactive Streams provides various options in both push and pull-based streams to control the data that is being produced and sent to the consumer.</li>
</ul>
<h3 id="reactive-java-libraries">Reactive Java Libraries</h3>
<p>The reactive landscape in Java has evolved a lot in recent years. Before we move on further to understand the Spring Webflux component, let&rsquo;s take a look into the reactive core libraries written in Java today. Here are the most popular ones:</p>
<ul>
<li><strong>RxJava</strong> : It is implemented out of the <a href="https://reactivex.io/">ReactorX</a> project which hosts implementations for multiple programming languages and platforms. <em>ReactiveX</em> is a combination of the best ideas from the <em>Observer</em> pattern, the <em>Iterator</em> pattern, and <em>functional programming</em> .</li>
<li><strong>Project Reactor</strong> : <a href="https://projectreactor.io/">Reactor</a> is a framework built by Pivotal and powered by Spring. It is considered as one of the foundations of the <em>reactive stack</em> in the <a href="https://spring.io/reactive">Spring</a> ecosystem. It implements Reactive API patterns which are based on the <em>Reactive Streams</em> specification.</li>
<li><strong>Akka Streams</strong> : Although it implements the Reactive Streams implementation, the <a href="http://doc.akka.io/docs/akka/snapshot/scala/stream/index.html">Akka Streams</a> API is completely decoupled from the Reactive Streams interfaces. It uses <em>Actors</em> to deal with the streaming data. It is considered a 3rd generation Reactive library.</li>
<li><strong>Ratpack</strong> : <a href="https://ratpack.io/">Ratpack</a> is a set of Java libraries used for building scalable and high-performance HTTP applications. It uses Java 8, <em>Netty</em> , and reactive principles to provide a basic implementation of Reactive Stream API. You can also use Reactor or RxJava along with it.</li>
<li><strong>Vert.x</strong> : <a href="https://vertx.io/">Vert.x</a> is a foundation project by <em>Eclipse</em> which delivers a <em>polyglot event-driven framework</em> for JVM. It is similar to Ratpack and allows to use RxJava or their native implementation for Reactive Streams API.</li>
</ul>
<p>Spring Webflux is internally built using the core components of RxJava and RxNetty.</p>
<h2 id="intro-to-java-9-reactive-streams-api">Intro to Java 9 Reactive Streams API</h2>
<p>The whole purpose of Reactive Streams was to introduce a standard for asynchronous stream processing of data with non-blocking backpressure. Hence, Java 9 introduced the <em>Reactive Streams API</em> . It is implemented based upon the <em>Publisher-Subscriber</em> Model or <em>Producer-Consumer</em> Model and primarily defines four interfaces:</p>
<ul>
<li><code>Publisher</code> : It is responsible for preparing and transferring data to subscribers as individual messages. A <code>Publisher</code> can serve multiple subscribers but it has only one method, <code>subscribe()</code> .</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Publisher</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">subscribe</span><span class="o">(</span><span class="n">Subscriber</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Subscriber</code> : A <code>Subscriber</code> is responsible for receiving messages from a <code>Publisher</code> and processing those messages. It acts as a terminal operation in the Streams API. It has four methods to deal with the events received:
<ul>
<li><code>onSubscribe(Subscription s)</code> : Gets called automatically when a publisher registers itself and allows the subscription to request data.</li>
<li><code>onNext(T t)</code> : Gets called on the subscriber every time it is ready to receive a new message of generic type T.</li>
<li><code>onError(Throwable t)</code> : Is used to handle the next steps whenever an error is monitored.</li>
<li><code>onComplete()</code> : Allows to perform operations in case of successful subscription of data.</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Subscriber</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSubscribe</span><span class="o">(</span><span class="n">Subscription</span> <span class="n">s</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNext</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Subscription</code> : It represents a relationship between the subscriber and publisher. It can be used only once by a single <code>Subscriber</code> . It has methods that allow requesting for data and to cancel the demand:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Subscription</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">request</span><span class="o">(</span><span class="kt">long</span> <span class="n">n</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Processor</code> : It represents a processing stage that consists of both <code>Publisher</code> and <code>Subscriber</code> .</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Processor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Subscriber</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;,</span> <span class="n">Publisher</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="introduction-to-spring-webflux">Introduction to Spring Webflux</h2>
<p>Spring introduced a <em>Multi-Event Loop</em> model to enable a reactive stack known as <code>WebFlux</code> . It is a fully non-blocking and annotation-based web framework built on <em>Project Reactor</em> which allows building reactive web applications on the HTTP layer. It provides support for popular inbuilt severs like <em>Netty</em> , <em>Undertow</em> , and <em>Servlet 3.1</em> containers.</p>
<p>Before we get started with Spring Webflux, we must accustom ourselves to two of the publishers which are being used heavily in the context of Webflux:</p>
<ul>
<li><code>Mono</code> : A <code>Publisher</code> that emits 0 or 1 element.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Mono</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mono</span> <span class="o">=</span> <span class="n">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">&#34;John&#34;</span><span class="o">);</span>
<span class="n">Mono</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">monoEmpty</span> <span class="o">=</span> <span class="n">Mono</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
<span class="n">Mono</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">monoError</span> <span class="o">=</span> <span class="n">Mono</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="k">new</span> <span class="n">Exception</span><span class="o">());</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Flux</code> : A <code>Publisher</code> that emits 0 to N elements which can keep emitting elements forever. It returns a sequence of elements and sends a notification when it has completed returning all its elements.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">);</span>
<span class="n">Flux</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fluxString</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">fromArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;A&#34;</span><span class="o">,</span> <span class="s">&#34;B&#34;</span><span class="o">,</span> <span class="s">&#34;C&#34;</span><span class="o">});</span>
<span class="n">Flux</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fluxIterable</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">fromIterable</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">,</span> <span class="s">&#34;B&#34;</span><span class="o">,</span> <span class="s">&#34;C&#34;</span><span class="o">));</span>
<span class="n">Flux</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fluxRange</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
<span class="n">Flux</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">fluxLong</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">10</span><span class="o">));</span>

<span class="c1">// To Stream data and call subscribe method
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">Flux</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">&#34;X&#34;</span><span class="o">,</span> <span class="s">&#34;Y&#34;</span><span class="o">,</span> <span class="s">&#34;Z&#34;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">log</span><span class="o">()</span>
    <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">dataStream</span><span class="o">::</span><span class="n">add</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Once the stream of data is created, it needs to be subscribed to so it starts emitting elements. The data won&rsquo;t flow or be processed until the <code>subscribe()</code> method is called. Also by using the <code>.log()</code> method above, we can trace and observe all the stream signals. The events are logged into the console.Reactor also provides operators to work with <code>Mono</code> and <code>Flux</code> objects. Some of them are:</p>
<ul>
<li><code>Map</code> - It is used to transform from one element to another.</li>
<li><code>FlatMap</code> - It flattens a list of <code>Publisher</code> s to the values that these publishers emit. The transformation is asynchronous.</li>
<li><code>FlatMapMany</code> - This is a <code>Mono</code> operator which is used to transform a <code>Mono</code> object into a <code>Flux</code> object.</li>
<li><code>DelayElements</code> - It delays the publishing of each element by a defined duration.</li>
<li><code>Concat</code> - It is used to combine the elements emitted by a <code>Publisher</code> by keeping the sequence of the publishers intact.</li>
<li><code>Merge</code> - It is used to combine the publishers without keeping its sequence.</li>
<li><code>Zip</code> - It is used to combine two or more publishers by waiting on all the sources to emit one element and combining these elements into an output value.</li>
</ul>
<h3 id="sping-webflux-dependencies">Sping Webflux Dependencies</h3>
<p>Until now we have spoken a lot about Reactive Streams and Webflux. Let&rsquo;s get started with the implementation part. We are going to build a REST API using Webflux and we will use MongoDB as our database to store data. We will build a user management service to store and retrieve users.</p>
<p>Let&rsquo;s initialize the Spring Boot application by defining a skeleton project in <a href="https://start.spring.io/">Spring Initializr</a>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/springcloud-community/image-bucket/2022/03/29/85c85f0feefa4a8398f2a4aacb423fa8.png" alt="Spring Initializr"></p>
<p>We have added the <em>Spring Reactive Web</em> dependency, <em>Spring Data Reactive MongoDB</em> to reactively connect to MongoDB, <em>Lombok</em> and <em>Spring DevTools</em> . The use of Lombok is optional, as it&rsquo;s a convenience library that helps us reduce boilerplate code such as getters, setters, and constructors, just by annotating our entities with Lombok annotations. Similar for Spring DevTools.</p>
<h3 id="data-model">Data Model</h3>
<p>Let&rsquo;s start by defining the <code>User</code> entity that we will be using throughout our implementation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@ToString</span>
<span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">of</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;id&#34;</span><span class="o">,</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;department&#34;</span><span class="o">})</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Data</span>
<span class="nd">@Document</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;users&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">salary</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">department</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We are initially using the Lombok annotations to define Getters, Setters, <code>toString()</code> , <code>equalsAndHashCode()</code> methods, and constructors to reduce boilerplate implementations. We have also used <code>@Document</code> to mark it as a MongoDB entity.</p>
<h3 id="persistence-layer---defining-repositories">Persistence Layer - Defining Repositories</h3>
<p>Next, we will define our Repository layer using the <code>ReactiveMongoRepository</code> interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">ReactiveMongoRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="service-layer">Service Layer</h3>
<p>Now we will define the Service that would make calls to MongoDB using Repository and pass the data on to the web layer:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span>
<span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ReactiveMongoTemplate</span> <span class="n">reactiveMongoTemplate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getAllUsers</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="n">String</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">updateUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userId</span><span class="o">,</span>  <span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">dbUser</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="n">dbUser</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
                    <span class="n">dbUser</span><span class="o">.</span><span class="na">setSalary</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getSalary</span><span class="o">());</span>
                    <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">dbUser</span><span class="o">);</span>
                <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">deleteUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">existingUser</span> <span class="o">-&gt;</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">existingUser</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">existingUser</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">fetchUsers</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">()</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">Sort</span>
                        <span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Order</span><span class="o">.</span><span class="na">asc</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">)))</span>
                <span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">addCriteria</span><span class="o">(</span><span class="n">Criteria</span>
                <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">regex</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
        <span class="o">);</span>

        <span class="k">return</span> <span class="n">reactiveMongoTemplate</span>
                <span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We have defined service methods to save, update, fetch, search and delete a user. We have primarily used <code>UserRepository</code> to store and retrieve data from MongoDB, but we have also used a <code>ReactiveTemplate</code> and <code>Query</code> to search for a user given by a regex string.</p>
<h3 id="web-layer">Web Layer</h3>
<p>We have covered the middleware layers to store and retrieve data, let&rsquo;s just focus on the web layer. Spring Webflux supports two programming models:</p>
<ul>
<li>Annotation-based Reactive components</li>
<li>Functional Routing and Handling</li>
</ul>
<h4 id="annotation-based-reactive-components">Annotation-based Reactive Components</h4>
<p>Let&rsquo;s first look into the annotation-based components. We can simply create a <code>UserController</code> for that and annotate with routes and methods:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/users&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@PostMapping</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span>
    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getAllUsers</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">getAllUsers</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/{userId}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="nf">getUserById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">userId</span><span class="o">){</span>
        <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">::</span><span class="n">ok</span><span class="o">)</span>
                <span class="o">.</span><span class="na">defaultIfEmpty</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/{userId}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="nf">updateUserById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">userId</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span><span class="n">user</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">::</span><span class="n">ok</span><span class="o">)</span>
                <span class="o">.</span><span class="na">defaultIfEmpty</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">.</span><span class="na">badRequest</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/{userId}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span> <span class="nf">deleteUserById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">deleteUser</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="o">())</span>
                <span class="o">.</span><span class="na">defaultIfEmpty</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/search&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">searchUsers</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">fetchUsers</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This almost looks the same as the controller defined in Spring MVC. But the major difference between Spring MVC and Spring Webflux relies on how the request and response are handled using non-blocking publishers <em>Mono</em> and <em>Flux</em> .</p>
<p><strong>We don&rsquo;t need to call subscribe methods in the Controller as the internal classes of Spring would call it for us at the right time</strong> .</p>
<h4 id="do-not-block">Do Not Block</h4>
<p>We must make sure that we don&rsquo;t use any blocking methods throughout the lifecycle of an API. Otherwise, we lose the main advantage of reactive programming!</p>
<h4 id="functional-routing-and-handling">Functional Routing and Handling</h4>
<p>Initially, the Spring Functional Web Framework was built and designed for Spring Webflux but later it was also introduced in Spring MVC. We use functions for routing and handling requests. This introduces an alternative programming model to the one provided by the Spring annotation-based framework.</p>
<p>First of all, we will define a <code>Handler</code> function that can accept a <code>ServerRequest</code> as an incoming argument and returns a <code>Mono</code> of <code>ServerResponse</code> as the response of that functional method. Let&rsquo;s name the handler class as <code>UserHandler</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">getAllUsers</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ServerResponse</span>
                <span class="o">.</span><span class="na">ok</span><span class="o">()</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">getAllUsers</span><span class="o">(),</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span>
                <span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">pathVariable</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">ServerResponse</span>
                        <span class="o">.</span><span class="na">ok</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">switchIfEmpty</span><span class="o">(</span><span class="n">ServerResponse</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">user</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">ServerResponse</span>
                        <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="n">u</span><span class="o">),</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">updateUserById</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">pathVariable</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">);</span>
        <span class="n">Mono</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">updatedUser</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">updatedUser</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">ServerResponse</span>
                        <span class="o">.</span><span class="na">ok</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">u</span><span class="o">),</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">deleteUserById</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">deleteUser</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">pathVariable</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">ServerResponse</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">u</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
                <span class="o">.</span><span class="na">switchIfEmpty</span><span class="o">(</span><span class="n">ServerResponse</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Next, we will define the router function. Router functions usually evaluate the request and choose the appropriate handler function. They serve as an alternate to the <code>@RequestMapping</code> annotation. So we will define this <code>RouterFunction</code> and annotate it with <code>@Bean</code> within a <code>@Configuration</code> class to inject it into the Spring application context:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RouterConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="n">RouterFunction</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">routes</span><span class="o">(</span><span class="n">UserHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span><span class="n">GET</span><span class="o">(</span><span class="s">&#34;/handler/users&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)),</span> <span class="n">handler</span><span class="o">::</span><span class="n">getAllUsers</span><span class="o">)</span>
                <span class="o">.</span><span class="na">andRoute</span><span class="o">(</span><span class="n">GET</span><span class="o">(</span><span class="s">&#34;/handler/users/{userId}&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)),</span> <span class="n">handler</span><span class="o">::</span><span class="n">getUserById</span><span class="o">)</span>
                <span class="o">.</span><span class="na">andRoute</span><span class="o">(</span><span class="n">POST</span><span class="o">(</span><span class="s">&#34;/handler/users&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)),</span> <span class="n">handler</span><span class="o">::</span><span class="n">create</span><span class="o">)</span>
                <span class="o">.</span><span class="na">andRoute</span><span class="o">(</span><span class="n">PUT</span><span class="o">(</span><span class="s">&#34;/handler/users/{userId}&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)),</span> <span class="n">handler</span><span class="o">::</span><span class="n">updateUserById</span><span class="o">)</span>
                <span class="o">.</span><span class="na">andRoute</span><span class="o">(</span><span class="n">DELETE</span><span class="o">(</span><span class="s">&#34;/handler/users/{userId}&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)),</span> <span class="n">handler</span><span class="o">::</span><span class="n">deleteUserById</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Finally, we will define some properties as part of <code>application.yaml</code> in order to configure our database connection and server config.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">spring-webflux-guide</span><span class="w">
</span><span class="w">  </span><span class="nt">webflux</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">base-path</span><span class="p">:</span><span class="w"> </span><span class="l">/api</span><span class="w">
</span><span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">mongodb</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">authentication-database</span><span class="p">:</span><span class="w"> </span><span class="l">admin</span><span class="w">
</span><span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">mongodb://localhost:27017/test</span><span class="w">
</span><span class="w">      </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">io</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">reflectoring</span><span class="p">:</span><span class="w"> </span><span class="l">DEBUG</span><span class="w">
</span><span class="w">    </span><span class="nt">org</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">springframework</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">web</span><span class="p">:</span><span class="w"> </span><span class="l">INFO</span><span class="w">
</span><span class="w">        </span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">mongodb</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">core</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="nt">ReactiveMongoTemplate</span><span class="p">:</span><span class="w"> </span><span class="l">DEBUG</span><span class="w">
</span><span class="w">    </span><span class="nt">reactor</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">netty</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">client</span><span class="p">:</span><span class="w"> </span><span class="l">DEBUG</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>This constitutes our basic non-blocking REST API using Spring Webflux. Now this works as a Publisher-Subscriber model that we were talking about initially in this article.</p>
<h3 id="server-sent-events">Server-Sent Events</h3>
<p><em>Server-Sent Events</em> (SSE) is an HTTP standard that provides the capability for servers to push streaming data to the web client. The flow is unidirectional from server to client and the client receives updates whenever the server pushes some data. This kind of mechanism is often used for real-time messaging, streaming or notification events. Usually, for multiplexed and bidirectional streaming, we often use <em>Websockets</em> . But SSE are mostly used for the following use-cases:</p>
<ul>
<li>Receiving live feed from the server whenever there is a new or updated record.</li>
<li>Message notification without unnecessary reloading of a server.</li>
<li>Subscribing to a feed of news, stocks, or cryptocurrency</li>
</ul>
<p>The biggest limitation of SSE is that it&rsquo;s unidirectional and hence information can&rsquo;t be passed to a server from the client. Spring Webflux allows us to define server streaming events which can send events in a given interval. The web client initiates the REST API call and keeps it open until the event stream is closed.</p>
<p>The server-side event would have the content type <code>text/event-stream</code> . Now we can define a Server Side Event streaming endpoint using WebFlux by simply returning a <code>Flux</code> and specifying the content type as <code>text/event-stream</code> . So let&rsquo;s add this method to our existing <code>UserController</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/stream&#34;</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_EVENT_STREAM_VALUE</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">streamAllUsers</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span>
                <span class="o">.</span><span class="na">getAllUsers</span><span class="o">()</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">Flux</span>
                        <span class="o">.</span><span class="na">zip</span><span class="o">(</span><span class="n">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">2</span><span class="o">)),</span>
                                <span class="n">Flux</span><span class="o">.</span><span class="na">fromStream</span><span class="o">(</span><span class="n">Stream</span><span class="o">.</span><span class="na">generate</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">user</span><span class="o">))</span>
                        <span class="o">)</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Tuple2</span><span class="o">::</span><span class="n">getT2</span><span class="o">)</span>
                <span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Here, we will stream all the users in our system every 2 seconds. This serves the whole list of updated users from the MongoDB every interval.</p>
<h3 id="webflux-internals">Webflux Internals</h3>
<p>Traditionally, Spring MVC uses the <em>Tomcat</em> server for servlet stack applications whereas Spring WebFlux uses <em>Reactor Netty</em> by default for reactive stack applications.</p>
<p><em>Reactor Netty</em> is an asynchronous, event-driven network application framework built out of Netty server which provides non-blocking and backpressure-ready network engines for HTTP, TCP, and UDP clients and servers.</p>
<p>Spring WebFlux automatically configures Reactor Netty as the default server but if we want to override the default configuration, we can simply do that by defining them under server prefix.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">  </span><span class="nt">http2</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>We can also define the other properties in the same way that start with the <code>server</code> prefix by overriding the default server configuration.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Spring WebFlux or Reactive non-blocking applications usually do not make the applications run faster. The essential benefit it serves is the ability to scale an application with a small, fixed number of threads and lesser memory requirements while at the same time making the best use of the available processing power. It often makes a service more resilient under load as they can scale predictably.</p>
<p>WebFlux is a good fit for highly concurrent applications. Applications which would be able to process a huge number of requests with as few resources as possible. WebFlux is also relevant for applications that need scalability or to stream request data in real time. While implementing a micro-service in WebFlux we must take into account that the entire flow uses reactive and asynchronous programming and none of the operations are blocking in nature.</p>
<p>If you want to learn about how to build a client to a reactive server, have a look at our <a href="https://reflectoring.io/spring-webclient/"><code>WebClient</code> article</a>.</p>
<p>You can refer to all the source code used in the article on <a href="https://github.com/thombergs/code-examples/tree/master/spring-webflux/">Github</a>.</p>
<blockquote>
<p>Reference <a href="https://reflectoring.io/getting-started-with-spring-webflux/#intro-to-java-9-reactive-streams-api">https://reflectoring.io/getting-started-with-spring-webflux/#intro-to-java-9-reactive-streams-api</a></p>
</blockquote>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://www.springcloud.io/tags/spring-webfux/">spring-webfux</a>
          <a href="https://www.springcloud.io/tags/reactive-streams/">reactive-streams</a>
          <a href="https://www.springcloud.io/tags/project-reactor/">project-reactor</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/2022-03/cve-report-published-for-spring-framework/">
            <span class="next-text nav-default">CVE report published for Spring Framework</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://twitter.com/springcloud_io" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>


<a href="https://www.springcloud.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2021 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











  <script>
    $("#openSearch, #openSearchMobile").click(function(){
      $(".modal-dialog").addClass("visible");
    });

    $("#closeSearch").click(function(){
      $(".modal-dialog").removeClass("visible");
    });

    $(document).click(function(event) {
    
      if (!$(event.target).closest(".modal-content, #openSearch, #openSearchMobile").length) {
        $("body").find(".modal-dialog").removeClass("visible");
      }
    });
  </script>





</body>
</html>
